<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        let jsonp=(url,data={},callback='callback')=>
       {       //url+data->script 需要的的src
           let datasrc=url.indexOf('?')===-1?'?':'&'
           console.log(datasrc) //1.js 可以动态创建标签 document.createElment 函数作用域 ，外界可以访问到
            for(let key in data){
                datasrc+=`${key}=${data[key]}&`
            }
        
         datasrc+='callback='+callback
        //构造script 
        let  oscript=document.createElement('script');
        oscript.src=url+datasrc;
        document.body.appendChild(oscript)

        return new Promise((resolve,reject)=>{
            window[callback]=(data)=>{
                try{
                    resolve(data)
                }
                catch(e){
                    reject(e)
                }
                finally{
                    oscript.parentNode.removeChild(oscript)
                }
            }
        }
    )
}
    

        // return new Promise(
        //请使用jsonp 原理 ，封装json函数，不用再为了远程资源发愁 
        //window 
        // jsonp('https://photo.sina.cn/aj/index?a=1',{
        //     page:1,
        //     cate:'recommend'
        // })
        // .then(response=>{
        //     console.log(response,'++++++')
        //  }
        // )
        jsonp('http://localhost:3000',{
            a:1,
            callback:'funA'
        })
        .then(response=>{
            console.log(response,'++++++')
           }
         )
    </script>
</body>
</html>

